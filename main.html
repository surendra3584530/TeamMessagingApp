<!DOCTYPE html>
<html>
    <title>Team-Messaging-App</title>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-route.js"></script>
    </head> 
    <body ng-app="myApp" ng-controller="myCtrl">
       <div class="container">
            <h1>Team-Messaging-App</h1>
        <div>
            <a href="#!login">Login</a>
            <a href="#!signUp">signUp</a>
            <div ng-view></div>
        </div>
       </div>
        <script>
                var app = angular.module('myApp', ["ngRoute"]);
                app.config(['$routeProvider',function($routeProvider) {
                    $routeProvider
                    .when("/login", {
                        templateUrl : "login.html",
                        controller: "login"
                    })
                    .when("/signUp", {
                        templateUrl : "signUp.html",
                        controller: "signUp"
                    })
                    .when("/channel", {
                        templateUrl : "channels.html",
                        controller: "channel"
                    })
                }])

                app.controller('myCtrl', function($scope) {
                    $scope.check = 'true';
                });
                app.controller('login',function($scope,$http,$window, $timeout,$location){
                    $scope.loginSubmit= function()
                    {
                        console.log("login")
                        var data = JSON.stringify({
                            email: $scope.email,
                            password:  $scope.password
                        });
                        console.log(data);
                        $http({
                            url: "/login", 
                            method: "POST",
                            data: data
                        }).then(data=>{
                            console.log(data,data.data)
                            if(data.data === "Login successfully...")
                            {
                                $timeout(function() {
                                    alert(data.data);
                                },0).then(()=>{
                                    $window.location.href = "#!channel"
                                })
                            }
                            else{
                                $timeout(function() {
                                    alert(data.data);
                                },0).then(()=>{
                                    $window.location.href = "#!login"
                                })
                            }
                        }).catch(err=>{
                            console.log("err:",err);
                        })
                    }
                })
                app.controller('signUp', function($scope,$http,$window, $timeout){
                    $scope.submit= function(){
                    var data = JSON.stringify({
                            email: $scope.email,
                            region : $scope.region,
                            username : $scope.username,
                            password:  $scope.password
                    });
                    $http({
                        url: "/signUp", 
                        method: "POST",
                        data: data
                    }).then(data=>{
                        console.log(data,data.data)
                        $timeout(function() {
                            alert(data.data);
                      },0).then(function(){
                          window.location.href = "/";
                      });
                    }).catch(err=>{
                        console.log("err:",err);
                    }) 
                  }
                })
                app.controller('channel', function($scope){
                   
                })
        </script>
    </body>
</html>
